<?php namespace common\components; use \SimpleXMLElement; class SecureTerminal {private $_default_settings; private $_MD; private $_PaRes; public function __construct() {$this->_default_settings = array('language' => 'en', 'transaction_type' => 'purchase', 'authenticity_token' => '8e0bfde4bc5087de16655624405e46dc0712736c', 'number_of_installments' => 1, 'moto' => FALSE, 'key' => 'Rene*salis1', 'currency' => 'BAM', 'test' => TRUE ); } public static function init() {return new SecureTerminal(); } public function listener() {if ($_POST) {if (isset($_POST['MD'])) {$this->_MD = $_POST['MD']; } if (isset($_POST['PaRes'])) {$this->_PaRes = $_POST['PaRes']; } return $this->_finish_transaction(); } else {die('Stranica ne postoji!'); } } private function _finish_transaction() {$Vxasakctl54d = curl_init(); curl_setopt_array($Vxasakctl54d, array(CURLOPT_URL => $this->_get_api_url(), CURLOPT_HTTPHEADER => array('Content-Type: application/xml', 'Accept: application/xml'), CURLOPT_POST => 1, CURLOPT_POSTFIELDS => $this->_generate_xml(), CURLOPT_RETURNTRANSFER => 1, CURLOPT_SSL_VERIFYPEER => 0, CURLOPT_SSL_VERIFYHOST => 0, )); $V0qbkwtfylew = curl_exec($Vxasakctl54d); $Vabn3i5sx5ii = curl_getinfo($Vxasakctl54d, CURLINFO_HTTP_CODE); curl_close($Vxasakctl54d); if ($Vabn3i5sx5ii == 201) {return simplexml_load_string($V0qbkwtfylew); } return FALSE; } private function _generate_xml() {$Vm300tqzqu5l = new SimpleXMLElement('<secure-message/>'); $Vm300tqzqu5l->addChild('MD', $this->_MD); $Vm300tqzqu5l->addChild('PaRes', $this->_PaRes); return $Vm300tqzqu5l->asXML(); } private function _get_api_url() {$Vbdwshep0zk3 = ($this->_default_settings['test'] === TRUE) ? 'test' : ''; return 'https://ipg'.$Vbdwshep0zk3.'.pikpay.ba/pares'; } }